/*!CK:3221995997!*//*1382729607,178158631*/

if (self.CavalryLogger) { CavalryLogger.start_js(["gMrjy"]); }

__d("legacy:UIControllerRegistry",[],function(a,b,c,d){a.__UIControllerRegistry=a.__UIControllerRegistry||{};},3);
__d("UIIntentionalStreamRefresh",["Arbiter","LiveTimer","Run","UIIntentionalStreamMessage","UserActivity","coalesce","copyProperties"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('LiveTimer'),i=b('Run'),j=b('UIIntentionalStreamMessage'),k=b('UserActivity'),l=b('coalesce'),m=b('copyProperties');function n(o,p){this.isAutoRefreshing=false;this.lastRefresh=Date.now();n.instance=this;this.setAutoRefreshConfig(o);this.updateConfigHandler=g.subscribe(j.UPDATE_AUTOREFRESH_CONFIG,this.updateAutoRefreshConfig.bind(this));this.updateRefreshTimeHandler=g.subscribe(j.UPDATE_LAST_REFRESH_TIME,this.updateLastRefreshTime.bind(this));i.onLeave(this.unload.bind(this));this.userActivity();this.uaToken=k.subscribe(this.userActivity.bind(this));this.autoRefreshInterval=setInterval(this.checkAutoPageRefresh.bind(this),this.checkAutoRefreshTimeInterval);this.activeRefreshInterval=setInterval(this.checkActiveRefresh.bind(this),this.checkActiveRefreshTimeInterval);this.enableAutoRefresh(p);g.subscribe(j.UPDATE_STREAM,h.loop.bind(h,true));g.subscribe(j.REFRESH_STREAM,h.loop.bind(h,true));}m(n,{DISABLE_AUTOREFRESH_TIME:4*60*1000,CHECK_AUTOREFRESH_INTERVAL:5*60*1000,AUTOREFRESH_INACTIVE_TIME:30*60*1000,CHECK_ACTIVE_REFRESH_TIME:5*60*1000,ACTIVE_REFRESH_TIME:30*1000});m(n.prototype,{updateAutoRefreshConfig:function(o,p){if(o==j.UPDATE_AUTOREFRESH_CONFIG)this.setAutoRefreshConfig(p);},updateLastRefreshTime:function(o){if(o==j.UPDATE_LAST_REFRESH_TIME)this.lastRefresh=Date.now();},setAutoRefreshConfig:function(o){o=o||{};var p=24*60*60*1000;if(!this.storyInterval)this.storyInterval=l(o.story_interval,null);this.allowAutoRefresh=l(o.allow_auto_refresh,false);this.inactiveThreshold=l(o.inactive_threshold,0);this.activeRefreshTime=l(o.fast_refresh_rate,p);this.inactiveRefreshTime=l(o.slow_refresh_rate,p);this.allowPolling=l(o.allow_polling,false);this.refreshFactor=l(o.refresh_factor,10);this.minRefreshInterval=l(o.min_refresh_interval,60*1000);this.activeRefresh=l(o.active_refresh,false);this.checkActiveRefreshTimeInterval=l(o.check_active_refresh_interval,n.CHECK_ACTIVE_REFRESH_TIME);this.activeRefreshTimeInterval=l(o.active_refresh_interval,n.ACTIVE_REFRESH_TIME);this.disableAutoRefreshTime=l(o.disable_autorefresh_time,n.DISABLE_AUTOREFRESH_TIME);this.checkAutoRefreshTimeInterval=l(o.check_autorefresh_time_interval,n.CHECK_AUTOREFRESH_INTERVAL);this.autoRefreshInactiveTime=l(o.autorefresh_inactive_time,n.AUTOREFRESH_INACTIVE_TIME);return this;},unload:function(){this.enableAutoRefresh(false);this.cleanupRefreshInterval();k.unsubscribe(this.uaToken);this.updateConfigHandler&&this.updateConfigHandler.unsubscribe();this.updateRefreshTimeHandler&&this.updateRefreshTimeHandler.unsubscribe();},userActivity:function(){var o=this.isInactive();this.lastActivity=Date.now();this.isAutoRefreshing=true;if(o&&this.canAutoRefresh())this.runAutoRefresh();return true;},isInactive:function(){return this.getMSSinceLastActivity()>this.inactiveThreshold;},getMSSinceLastActivity:function(){return Date.now()-this.lastActivity;},getMSSinceLastRefresh:function(){return Date.now()-this.lastRefresh;},getRefreshInterval:function(){if(this.isInactive()){return this.inactiveRefreshTime;}else if(this.storyInterval!=null){var o=this.storyInterval*this.refreshFactor;return Math.max(o,this.activeRefreshTime);}else return this.activeRefreshTime;},canAutoRefresh:function(){return this.isAutoRefreshing&&this.allowAutoRefresh;},cancelUpdate:function(){if(this.updateTask){clearTimeout(this.updateTask);this.updateTask=null;}},runUpdatePoll:function(){this.updateTask=null;if(this.canAutoRefresh())this.runAutoRefresh();},runAutoRefresh:function(){var o=50;if(this.getMSSinceLastRefresh()>=this.minRefreshInterval-o)g.inform(j.UPDATE_STREAM);this.schedulePoll(this.getRefreshInterval());},schedulePoll:function(o){this.cancelUpdate();if(this.allowPolling)this.updateTask=setTimeout(this.runUpdatePoll.bind(this),o);},enableAutoRefresh:function(o,p){this.isAutoRefreshing=o;if(o){var q=p?0:this.getRefreshInterval();this.schedulePoll(q);}else this.cancelUpdate();},checkAutoPageRefresh:function(){if(!this.allowAutoRefresh)return;if(this.isAutoRefreshing&&(this.getMSSinceLastActivity()>this.disableAutoRefreshTime))this.isAutoRefreshing=false;if(this.getMSSinceLastRefresh()<this.autoRefreshInactiveTime)return;var o=this.getMSSinceLastActivity();if(o>this.autoRefreshInactiveTime)g.inform(j.REFRESH_STREAM,{});},checkActiveRefresh:function(){if(!this.allowAutoRefresh)return;if(this.getMSSinceLastRefresh()<this.activeRefreshTimeInterval)return;if(this.getMSSinceLastActivity()<this.activeRefreshTimeInterval)g.inform(j.UPDATE_STREAM);},cleanupRefreshInterval:function(){if(this.autoRefreshInterval){clearInterval(this.autoRefreshInterval);this.autoRefreshInterval=null;}if(this.activeRefreshInterval){clearInterval(this.activeRefreshInterval);this.activeRefreshInterval=null;}}});e.exports=n;});
__d("UIIntentionalStream",["Animation","Arbiter","AsyncRequest","AsyncResponse","CSS","DataStore","DOM","DOMScroll","Event","HTML","JSLogger","NavigationMessage","OnVisible","PageTransitions","Run","ScrollAwareDOM","Style","UIIntentionalStreamMessage","UIIntentionalStreamRefresh","UIPagelet","URI","Vector","$","coalesce","copyProperties","createArrayFrom","ge","isEmpty","merge","reportData","startsWith"],function(a,b,c,d,e,f){var g=b('Animation'),h=b('Arbiter'),i=b('AsyncRequest'),j=b('AsyncResponse'),k=b('CSS'),l=b('DataStore'),m=b('DOM'),n=b('DOMScroll'),o=b('Event'),p=b('HTML'),q=b('JSLogger'),r=b('NavigationMessage'),s=b('OnVisible'),t=b('PageTransitions'),u=b('Run'),v=b('ScrollAwareDOM'),w=b('Style'),x=b('UIIntentionalStreamMessage'),y=b('UIIntentionalStreamRefresh'),z=b('UIPagelet'),aa=b('URI'),ba=b('Vector'),ca=b('$'),da=b('coalesce'),ea=b('copyProperties'),fa=b('createArrayFrom'),ga=b('ge'),ha=b('isEmpty'),ia=b('merge'),ja=b('reportData'),ka=b('startsWith');function la(){h.subscribe(x.SET_AUTO_INSERT,ma);}function ma(oa,pa){if(oa!=x.SET_AUTO_INSERT)return;var qa=na.instance;if(qa)qa.pauseAutoInsert=pa.pause;}function na(oa,pa,qa,ra,sa,ta,ua,va,wa,xa,ya){if(!oa)throw new Error('UIIntentionalStream instantiated with no root.');ea(this,{id:oa.id,root:oa,instanceName:pa,newest:qa,oldest:ra,oldestMR:ra,shouldShowHidden:false,defaultFilter:sa,currentFilterKey:xa,sourceType:ta,lastSeenTime:ya,hasPendingRefresh:false,pauseAutoInsert:false,error:m.scry(oa,'div.UIIntentionalStream_Error')[0],pager:m.scry(oa,'div.uiMorePager')[0],filterNullState:m.scry(oa,'div.friendListFilterNullState')[0],streamContent:m.find(oa,'.UIIntentionalStream_Content'),requestNum:0,scrollLoadCount:1,maxScrollLoadCount:1,scrollPosition:0,lastViewStateID:0,cachedScrollQID:0,jslog:q.create('stream'),scrollListener:null,newIndexOffset:0});this.addScrollTrace('init',{});u.onLeave(this.unload.bind(this));if(!na.instances)na.instances={};na.instances[pa]=this;na.instance=this;la();this.setupSubscriptions();}ea(na.prototype,{subscribeToComposerPublish:function(){this.subscriptions.push(h.subscribe('composer/publish',function(event,oa){var pa=ca(oa.composer_id).getAttribute('data-location');if(pa==='maincolumn'&&oa.streamStory)this.addComposerContent(oa.streamStory,500);}.bind(this)));},setupSubscriptions:function(){this.subscriptions=[];this.subscribeToComposerPublish();this.subscriptions.push(h.subscribe(x.UPDATE_STREAM,this.updateStream.bind(this)));this.subscriptions.push(h.subscribe(x.REFRESH_STREAM,this.refreshStream.bind(this)));this.scrollListener=o.listen(window,'scroll',this.checkFirstScroll.bind(this));this.checkFirstScroll();u.onLoad(this.checkFirstStory.bind(this));},tearDownSubscriptions:function(){if(!this.subscriptions)return;this.subscriptions.forEach(h.unsubscribe);this.subscriptions=null;if(this.scrollListener){this.scrollListener.remove();this.scrollListener=null;}},unload:function(){this.addScrollTrace('unload',{});h.inform(x.UNLOAD);this.tearDownSubscriptions();na.instance=null;na.instances[this.instanceName]=null;this.clearScrollLoader(true);window.disableScrollLoad=null;y.instance&&y.instance.unload();},_getUpdateInsertType:function(){return na.REFRESH_PREPEND;},updateStream:function(oa){if(oa!=x.UPDATE_STREAM||this.hasPendingRefresh||this.isAutoRefreshPaused())return;this.loadNewer({showLoader:false,ignoreSelf:true,insertType:this._getUpdateInsertType()});},clearScrollLoader:function(oa){if(this.currentScrollListener){this.currentScrollListener.remove();this.currentScrollListener=null;}if(oa||this.scrollLoadCount>=this.maxScrollLoadCount)window.disableScrollLoad=true;},loadOlderPosts:function(oa){var pa={filter:this.getCurrentFilterKey(),oldest:this.oldest,oldestMR:this.oldestMR,last_seen_time:this.lastSeenTime,scroll_count:this.scrollLoadCount,scroll_position:this.scrollPosition,last_viewstate_id:this.lastViewStateID,cached_scroll_qid:this.cachedScrollQID};this.homeloadID&&(pa.homeload_id=this.homeloadID);pa=ia(pa,oa);this.loadWithParams(pa);},loadWithParams:function(oa){var pa=m.scry(this.root,'div.fbStreamPager.hasMorePosts')[0];if(pa){if(k.hasClass(pa,'async_saving'))return;k.addClass(pa,'async_saving');}this.addScrollTrace('loadwithparams',oa);z.loadFromEndpoint('MoreStoriesPagelet','home_stream',oa,{append:true,usePipe:true});},setScrollLoadCount:function(oa){this.maxScrollLoadCount=oa;},setHomeloadID:function(oa){this.homeloadID=oa;},loadMoreOnScroll:function(oa,pa){if(window.disableScrollLoad)return;var qa=function(){if(window.disableScrollLoad)return;var ta={delay_load_count:pa};this.loadOlderPosts(ta);}.bind(this),ra=m.scry(this.root,'ul.uiStream li.genericStreamStory');if(!ra.length)return;this.addScrollTrace('loadmoreonscroll',{});var sa=ra[ra.length-oa-1];if(sa){this.currentScrollListener=new s(sa,qa,null,0);}else qa();},updateTimeRange:function(oa,pa){if(!this.newest||this.newest<oa){this.newest=oa;this.addScrollTrace('update_newest',{newest:this.newest});}if(!this.oldest||(pa&&(pa<this.oldest))){this.oldest=pa;this.addScrollTrace('update_oldest',{oldest:this.oldest});}},updateOldestMR:function(oa){if(!this.oldestMR||oa<this.oldestMR){this.oldestMR=oa;this.addScrollTrace('update_oldestmr',{oldestmr:this.oldestMR});}},updateScrollPosition:function(oa){this.scrollPosition=oa;this.addScrollTrace('update_scrollposition',{scrollposition:this.scrollPosition});},updateLastViewStateID:function(oa){this.lastViewStateID=oa;this.addScrollTrace('update_lastviewstateid',{lastviewstateid:this.lastViewStateID});},updateCachedScrollQID:function(oa){this.cachedScrollQID=oa;this.addScrollTrace('update_cachedscrollqid',{qid:this.cachedScrollQID});},getID:function(){return this.id;},getCurrentFilterKey:function(){if(this.currentFilterKey)return this.currentFilterKey;var oa=aa.getMostRecentURI().getQueryData();if(oa&&oa.sk){this.currentFilterKey=oa.sk;}else if(oa&&oa.filter){this.currentFilterKey=oa.filter;}else if(this.defaultFilter)this.currentFilterKey=this.defaultFilter;return this.currentFilterKey;},resetFilterKey:function(oa){this.currentFilterKey=oa;},loadOlder:function(oa){oa=oa||{};if(!this.oldest)return;var pa=this.getCurrentParams();pa.oldest=this.oldest;this.refresh(na.REFRESH_APPEND,pa,oa);return this;},loadNewer:function(oa){if(!this.newest)return;oa=oa||{};var pa=this.getCurrentParams();pa.newest=this.newest;if(oa.ignoreSelf)pa.ignore_self=true;pa.load_newer=true;var qa=da(oa.insertType,na.REFRESH_PREPEND);this.refresh(qa,pa,oa);return this;},checkFirstStory:function(){this.logFirstStory('first_story_load');},checkFirstScroll:function(){if(this.scrollListener&&ba.getScrollPosition().y>0){this.scrollListener.remove();this.scrollListener=null;this.logFirstStory('first_scrolling');}},logFirstStory:function(oa){if(!ga('home_stream')||!ga('home_stream').childElementCount||!ga('home_stream').children[0].getAttribute('data-ft'))return;var pa=ga('home_stream').children[0].getAttribute('data-ft'),qa=JSON.parse(pa);if(!(("mf_story_key" in qa)&&("qid" in qa)))return;var ra={mf_story_key:qa.mf_story_key,qid:qa.qid};ja(oa,{ft:ra});},getCurrentParams:function(){var oa={},pa=aa.getMostRecentURI().getQueryData();pa.filter=this.getCurrentFilterKey();var qa=this.getValidParams();if(qa){qa.forEach(function(ra){oa[ra]=pa[ra];});}else oa=pa;return oa;},setHomeFilter:function(oa){this._homeFilter=oa;},setHomeFilterLoading:function(oa){if(this._homeFilter)this._homeFilter.setLoading(oa);},refresh:function(oa,pa,qa){h.inform(x.UPDATE_LAST_REFRESH_TIME);this.homeloadID&&(pa.homeload_id=this.homeloadID);this.addScrollTrace('refresh',{type:oa,data:pa,kwargs:qa});this.currentFilterKey=pa.filter;if(pa.filter==na.FEED_FILTER_KEY_DUAL_NEWS_FEED){this.currentFilterKey=this.defaultFilter;}else if(na.isHighlightsFilter(pa.filter)||pa.filter===na.FEED_FILTER_KEY_NEWS_FEED)this.defaultFilter=this.currentFilterKey;qa=qa||{};var ra=++this.requestNum,sa=da(qa.showLoader,true),ta=this.instanceName,ua=function(ya){na.getInstance(ta).handleResponse(ra,oa,ya,qa);},va=function(ya){na.getInstance(ta).handleError(ra,oa,ya,qa);},wa=function(ya){na.getInstance(ta).handleFinally(oa,pa.filter,ya);};if(!(pa.request_type=oa))pa.request_type='none';if(pa.filter){qa.show_hidden=pa.show_hidden?pa.show_hidden:false;}else qa.show_hidden=this.shouldShowHidden;pa=ea(this.getCurrentParams(),pa);this.hasPendingRefresh=true;var xa=new i().setURI(this.getEndpoint()).setReadOnly(true).setOption('retries',0).setMethod(this.getRefreshMethod()).setData(pa).setHandler(ua).setErrorHandler(va).setFinallyHandler(wa);if(oa==na.REFRESH_APPEND&&sa)xa.setStatusElement(this.pager);xa.send();if(oa==na.REFRESH_TRANSITION){if(this.pager)this.pager.style.display='none';this.clearScrollLoader();this.oldest=this.newest=null;}if(sa)this.setHomeFilterLoading(true);},addComposerContent:function(oa,pa){if(this.isOnNewsFeedFilter())k.addClass(oa,'uiStreamBoulderHighlight');this.addContentPrepend(oa,pa);},applyNewIndexes:function(oa){for(var pa=oa.length-1;pa>=0;pa--)oa[pa].setAttribute('data-insertion-position',--this.newIndexOffset);h.inform('Stream/totalHeadLoadedStories',-this.newIndexOffset);},addContentPrepend:function(oa,pa){if(oa.length){fa(oa).reverse().forEach(function(va){this.addContentPrepend(va,pa);}.bind(this));return;}var qa,ra=ba.getScrollPosition().y,sa=ba.getElementPosition(this.streamContent).y,ta=this.scrollOnPrepend&&ra>=sa;if(ta){var ua=function(va){var wa=m.find(va,'^li.uiStreamStory');if(!wa)return;l.set(wa,'origHeight',wa.offsetHeight);o.listen(va,'load',function(){var xa=l.get(wa,'origHeight');if(wa.offsetHeight!=xa){window.scrollBy(0,wa.offsetHeight-xa);l.set(wa,'origHeight',wa.offsetHeight);}});};qa=g.insert.curry(this.streamContent,oa,(function(va,wa){m.prependContent(this.streamContent,wa);h.inform('reflow');window.scrollBy(0,wa.offsetHeight);m.scry(wa,'img').forEach(ua);}).bind(this));}else qa=(function(){w.set(oa,'opacity',0);v.prependContent(this.streamContent,oa);h.inform('reflow');new g(oa).from('opacity',0).to('opacity',1).duration(400).ondone(function(){h.inform(x.UPDATE_HTML_CONTENT);}).go();}).bind(this);if(pa){k.hide(oa);m.appendContent(document.body,oa);setTimeout(function(){k.show(oa);qa();},pa);}else qa();},addContentAppend:function(oa){m.appendContent(this.streamContent,oa);},handleResponse:function(oa,pa,qa,ra){this.addScrollTrace('handle_response',{requestnum:oa,type:pa,kwargs:ra});ra=ra||{};var sa=qa.getPayload();this.filterNullState&&m.remove(this.filterNullState);if(ha(sa))return;if(sa.autoRefreshConfig)h.inform(x.UPDATE_AUTOREFRESH_CONFIG,sa.autoRefreshConfig);this.setHomeFilterLoading(false);if(pa==na.REFRESH_EXPAND){var ta=m.find(ca(ra.expandStoryID),'div.UIIntentionalStory_CollapsedStories');k.hide(ta);k.removeClass(ta,'UIIntentionalStory_CollapsedStoriesLoading');}if(this.error)this.error.style.display='none';if(oa!=this.requestNum)return;if('show_hidden' in ra)this.shouldShowHidden=ra.show_hidden;if('newestStoryTime' in sa&&sa.newestStoryTime>this.newest)this.newest=sa.newestStoryTime;if(pa!=na.REFRESH_PREPEND){if('oldestStoryTime' in sa&&(!this.oldest||sa.oldestStoryTime<this.oldest))this.oldest=sa.oldestStoryTime;if('scrollPosition' in sa)this.scrollPosition=sa.scrollPosition;if('lastViewStateID' in sa)this.lastViewStateID=sa.lastViewStateID;if('oldestMRStoryTime' in sa)this.oldestMR=sa.oldestMRStoryTime;if('cachedScrollQID' in sa){this.cachedScrollQID=sa.cachedScrollQID;}else this.cachedScrollQID=0;}if(sa.html){var ua=p(sa.html).getNodes();switch(pa){case na.REFRESH_PREPEND:this.applyNewIndexes(ua);this.addContentPrepend(ua);break;case na.REFRESH_APPEND:this.addContentAppend(ua);this.clearScrollLoader(true);break;case na.REFRESH_TRANSITION:m.setContent(this.streamContent,ua);this.scrollLoadCount=1;if(!ra.noScroll)n.scrollTo(new ba(0,0,"document"),false);break;case na.REFRESH_EXPAND:m.insertAfter(ca(ra.expandStoryID),ua);break;case na.DELAYED_STREAM:this.addContentAppend(ua);break;}h.inform(x.UPDATE_HTML_CONTENT);}},handleError:function(oa,pa,qa,ra){if(oa!=this.requestNum)return;this.setHomeFilterLoading(false);var sa=qa.getError();if(sa==1357001)j.defaultErrorHandler(qa);if(pa==na.REFRESH_EXPAND){var ta=m.find(ca(ra.expandStoryID),'div.UIIntentionalStory_CollapsedStories');k.removeClass(ta,'UIIntentionalStory_CollapsedStoriesLoading');}if(!ra.delayLoadCount&&pa!=na.REFRESH_PREPEND&&this.error)w.set(this.error,'display','block');},handleFinally:function(oa,pa){if(oa==na.REFRESH_TRANSITION){t.transitionComplete();h.inform(r.NAVIGATION_COMPLETED);}this.hasPendingRefresh=false;},getValidParams:function(){return na.VALID_PARAMS;},getEndpoint:function(){return na.ENDPOINT;},getRefreshMethod:function(){return na.REFRESH_METHOD;},isOnNewHighlights:function(){var oa=this.getCurrentFilterKey();return (na.isHighlightsFilter(oa)||(oa==na.FEED_FILTER_KEY_DUAL_NEWS_FEED&&na.isHighlightsFilter(this.defaultFilter)));},isLiveStreamBox:function(){var oa=this.getCurrentFilterKey();return oa&&oa.indexOf(na.FEED_FILTER_KEY_LIVE_STREAM_BOX)===0;},isOnNewsFeedFilter:function(){var oa=this.getCurrentFilterKey();return (oa==na.FEED_FILTER_KEY_NEWS_FEED||na.isHighlightsFilter(oa)||oa==na.FEED_FILTER_KEY_DUAL_NEWS_FEED);},isAutoRefreshPaused:function(){if(this.isOnNewHighlights()||this.isLiveStreamBox())return false;return this.pauseAutoInsert;},addScrollTrace:function(oa,pa){this.jslog.debug(oa,pa);},refreshStream:function(oa,pa){if(oa!=x.REFRESH_STREAM)return;var qa=this.getCurrentFilterKey(),ra={filter:qa},sa={filter:qa};pa.noScroll&&(sa.noScroll=1);this.refresh(na.REFRESH_TRANSITION,ra,sa);},getNewest:function(){return this.newest;}});ea(na,{ANIMATION_DURATION:300,REFRESH_METHOD:'GET',REFRESH_TRANSITION:1,REFRESH_PREPEND:2,REFRESH_APPEND:3,REFRESH_EXPAND:5,DELAYED_STREAM:6,FEED_FILTER_KEY_NEW_HIGHLIGHTS:'h',FEED_FILTER_KEY_NEWS_FEED:'lf',FEED_FILTER_KEY_DUAL_NEWS_FEED:'nf',FEED_FILTER_KEY_LIVE_STREAM_BOX:'pub',VALID_PARAMS:['filter','show_hidden'],ENDPOINT:'/ajax/intent.php',getInstance:function(oa){return na.instances[oa];},isHighlightsFilter:function(oa){if(!oa)return false;return ka(oa,na.FEED_FILTER_KEY_NEW_HIGHLIGHTS);},getStoriesByAssoc:function(oa){return m.scry(na.instance.root,'div.aid_'+oa);}});e.exports=na;});
__d("FutureHomeSideNav",["Arbiter","AsyncRequest","CSS","DOM","DOMPosition","Event","FutureSideNav","FutureSideNavItem","FutureSideNavSection","NavigationMessage","Parent","UIIntentionalStream","UIPagelet","emptyFunction","ge","tx"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('AsyncRequest'),i=b('CSS'),j=b('DOM'),k=b('DOMPosition'),l=b('Event'),m=b('FutureSideNav'),n=b('FutureSideNavItem'),o=b('FutureSideNavSection'),p=b('NavigationMessage'),q=b('Parent'),r=b('UIIntentionalStream'),s=b('UIPagelet'),t=b('emptyFunction'),u=b('ge'),v=b('tx');for(var w in m)if(m.hasOwnProperty(w))y[w]=m[w];var x=m===null?null:m.prototype;y.prototype=Object.create(x);y.prototype.constructor=y;y.__superConstructor__=m;function y(){if(m!==null)m.apply(this,arguments);}y.prototype.init=function(){x.init.apply(this,arguments);this.ajaxPipe=true;this.seeAllEndpoint="/ajax/home/generic.php";this.typeSections={favorites:'pinnedNav',profiles:'pinnedNav',apps:'appsNav',groups:'groupsNav',pages:'pagesNav',lists:'listsNav',interests:'interestsNav',connect_apps:'connectNav'};this.switchingFromTitanFixedFrame=false;this._arbiterSubscriptions.push(g.subscribe('titan_fixed_frame_changed',this.handleFixedFrameChanged.bind(this)),g.subscribe(p.NAVIGATION_FAVORITE_UPDATE,this.updateFavorite.bind(this)),g.subscribe(p.NAVIGATION_FIRST_RESPONSE,this.navigationFirstResponse.bind(this)));this._ensureHover('homeSideNav');};y.prototype.initMoreLink=function(fa){this._eventHandlers.push(l.listen(fa,'click',this._showMoreSections.bind(this,fa)));};y.prototype._showMoreSections=function(fa){var ga=j.scry(this.root,'div.belowThreshold');i.hide(fa);ga.forEach(function(ha){i.removeClass(ha,'belowThreshold');});};y.prototype.handleFixedFrameChanged=function(fa,ga,ha){if(ga){var ia=function(ja,ka){var la=k.getElementPosition(u(ka)).y;s.loadFromEndpoint(ja,ka,{fixed_frame:ga,selected_key:ha,v_pos:la});};ia('PinnedNavigationPagelet','pagelet_pinned_nav');ia('BookmarkNavigationPagelet','pagelet_bookmark_nav');if(u('chatFriendsOnline'))i.hide(u('chatFriendsOnline'));}else this.switchingFromTitanFixedFrame=true;};y.prototype.handlePageTransition=function(fa){if(this.switchingFromTitanFixedFrame){this.switchingFromTitanFixedFrame=false;return false;}else return x.handlePageTransition.call(this,fa);};y.prototype._initSection=function(fa){var ga=x._initSection.call(this,fa);for(var ha in this.typeSections){var ia=this.typeSections[ha];if(ga.id==ia){var ja=j.scry(ga.node,'h4.navHeader')[0];if(ja){var ka='\/bookmarks\/('+ha+')(\/)?';ga.seeall=this._initItem({node:ja,id:ga.id,endpoint:this.seeAllEndpoint,key:['bookmarks'],path:[{regex:ka}]});}}}return ga;};y.prototype._constructItem=function(fa,ga){return new ea(fa,ga);};y.prototype._constructSection=function(fa){return new ba(fa);};y.prototype.getSection=function(fa){return this.typeSections[fa]&&this.sections[this.typeSections[fa]];};y.prototype._getItemForKey=function(fa){var ga=x._getItemForKey.call(this,"nf");if(ga&&ga.matchKey(fa)){return ga;}else return x._getItemForKey.call(this,fa);};y.prototype._isCurrentPath=function(fa){return ((fa.getDomain()===this.uri.getDomain())&&(fa.getPath()==='/'||fa.getPath()==='/home.php'));};y.prototype._handleMenuClick=function(fa,ga,ha,event){if(i.hasClass(ha,'favorite')){g.inform(p.NAVIGATION_FAVORITE_UPDATE,{key:ga.numericKey,favorite:!fa.equals(this.getSection("favorites")),movetop:i.hasClass(ha,'movetop')});}else x._handleMenuClick.call(this,fa,ga,ha,event);};y.prototype.removeItemByKey=function(fa){g.inform(p.NAVIGATION_ITEM_REMOVED,fa);x.removeItemByKey.call(this,fa);};y.prototype.toggleItemByKey=function(fa,ga){var ha=this.getNodeForKey(fa);if(!ga){g.inform(p.NAVIGATION_ITEM_HIDDEN,fa);ha&&i.hide(ha);}else ha&&i.show(ha);var ia=this._getItemForKey(fa);this.getSection(ia.type).refresh();};y.prototype.removeItem=function(fa){var ga=this.getSection(fa.type);x.removeItem.call(this,fa);ga.refresh();};y.prototype.updateFavorite=function(fa,ga){var ha=this._findItem(function(qa){return qa.matchKey(ga.key)&&qa.canFavorite();}),ia=this.getSection("favorites"),ja=t,ka=ga.favorite?ia.addEndpoint:ia.removeEndpoint;if(ga.movetop)ka=ia.editEndpoint;if(!ha&&(ga.favorite||ga.movetop)){if(ga.movetop)var la=j.scry(this.root,'.expandableSideNav'),ma=la&&la.length&&i.hasClass(la[0],'expandedMode');ja=function(){s.loadFromEndpoint('PinnedNavigationPagelet','pagelet_pinned_nav',{expanded:ma});};}else if(!ha){ja=function(){s.loadFromEndpoint('BookmarkNavigationPagelet','pagelet_bookmark_nav');};}else{if(ga.movetop){i.show(ha.node);this.moveItem(ia,ha);var na=q.byClass(ha.node,'uiSideNav');if(na&&na.childNodes.length){var oa=q.byClass(j.scry(na,'.sortableItem')[0],'sideNavItem');j.insertBefore(oa,ha.node);i.removeClass(ha.node,'hidden');}}else{var pa=this.getSection(ha.type);if(ga.favorite){i.show(ha.node);this.moveItem(ia,ha);ha.showFavorite();}else if(!pa.equals(ia)){this.moveItem(pa,ha,true);ha.hideFavorite();}else this.removeItem(ha);pa.refresh();}ia.refresh();ga.key=ha.numericKey;g.inform('NavigationMessage.FAVORITES_UPDATED');}new h().setURI(ka).setData({id:ga.key,movetop:ga.movetop}).setHandler(ja).send();};y.prototype._doPageTransition=function(fa,ga){this._unloadStreams();var ha=x._doPageTransition.call(this,fa,ga);if(ha&&(fa.type=='groups'||fa.type=='lists'||fa.type=='interests')){fa.setCount(0);fa.hideUnreadDot();}return ha;};y.prototype._unloadStreams=function(){var fa=window.UIIntentionalStream&&r.instances,ga=['nile','global','friends','blade'];fa&&ga.forEach(function(ha){fa[ha]&&fa[ha].unload();});};y.prototype.navigationFirstResponse=function(){this.setSelected(this.loading);};for(var z in o)if(o.hasOwnProperty(z))ba[z]=o[z];var aa=o===null?null:o.prototype;ba.prototype=Object.create(aa);ba.prototype.constructor=ba;ba.__superConstructor__=o;function ba(fa){o.call(this,fa);this.editEndpoint='/ajax/bookmark/edit/';this.addEndpoint='/ajax/bookmark/add/';this.removeEndpoint='/ajax/bookmark/delete/';}ba.prototype.refresh=function(){var fa=j.scry(this.node,'li.sideNavItem'),ga=j.scry(this.node,'div.actionLinks'),ha=fa.some(i.shown);i.conditionShow(j.find(this.node,'h4.navHeader'),ha);ga.length&&i.conditionShow(ga[0],ha);};for(var ca in n)if(n.hasOwnProperty(ca))ea[ca]=n[ca];var da=n===null?null:n.prototype;ea.prototype=Object.create(da);ea.prototype.constructor=ea;ea.__superConstructor__=n;function ea(){if(n!==null)n.apply(this,arguments);}ea.prototype.canFavorite=function(){return !!this._getFavoriteLabel();};ea.prototype.showFavorite=function(){j.setContent(this._getFavoriteLabel(),"Eliminar de Favoritos");};ea.prototype.hideFavorite=function(){j.setContent(this._getFavoriteLabel(),"Agregar a favoritos");};ea.prototype.hideUnreadDot=function(){var fa=j.scry(this.node,'img.unreadDot')[0];fa&&i.hide(fa);};ea.prototype._getFavoriteLabel=function(){return j.scry(this.node,'li.favorite span.itemLabel')[0];};e.exports=y;});
__d("legacy:home-side-nav-future-js",["FutureHomeSideNav"],function(a,b,c,d){a.FutureHomeSideNav=b('FutureHomeSideNav');},3);
__d("AttachmentRelatedShareConstants",[],function(a,b,c,d,e,f){var g={ARTICLE_CLICK:'article_click',VIDEO_CLICK:'video_click'};e.exports=g;});
__d("KeyboardShortcuts",["KeyEventController","Layer","ModalLayer"],function(a,b,c,d,e,f){var g=b('KeyEventController'),h=b('Layer'),i=b('ModalLayer');function j(l,m,n){this.key=l;this.handler=m;this.filter=n;this.register();}j.prototype.register=function(){this.token=g.registerKey(this.key,this.handler,this.filter);};j.prototype.remove=function(){this.token.remove();};var k={_tokens:[[]],register:function(l,m,n){n=n||{};var o=n.allowDefault?m:function(event,s){m.apply(this,arguments);event.prevent();},p=n.baseFilters||[g.defaultFilter],q=function(event,s){for(var t=0,u=p.length;t<u;t++)if(!p[t](event,s))return false;return !n.filter||n.filter(event,s);},r=new j(l,o,q);this._tokens[this._tokens.length-1].push(r);return r;},init:function(){h.subscribe('show',function(l,m){if(m.hasBehavior(i))this.pushLayer();}.bind(this));h.subscribe('hide',function(l,m){if(m.hasBehavior(i))this.popLayer();}.bind(this));},pushLayer:function(){var l=this._tokens[this._tokens.length-1];l&&l.forEach(function(m){m.remove();});this._tokens.push([]);},popLayer:function(){var l=this._tokens.length-1;if(l<0)return;var m=this._tokens[l];m.forEach(function(o){o.remove();});this._tokens.pop();var n=this._tokens[l-1];n&&n.forEach(function(o){o.register();});}};k.init();e.exports=k;});
__d("FeedBaseKeyboardController",["$","Arbiter","AsyncDialog","AsyncRequest","CSS","DOM","DOMScroll","DOMQuery","Event","Focus","KeyboardShortcuts","KeyEventController","NavigationMessage","Parent","Run","SubscriptionsHandler","Vector","ViewportBounds","emptyFunction","ge","getActiveElement","isAsyncScrollQuery","throttle"],function(a,b,c,d,e,f){var g=b('$'),h=b('Arbiter'),i=b('AsyncDialog'),j=b('AsyncRequest'),k=b('CSS'),l=b('DOM'),m=b('DOMScroll'),n=b('DOMQuery'),o=b('Event'),p=b('Focus'),q=b('KeyboardShortcuts'),r=b('KeyEventController'),s=b('NavigationMessage'),t=b('Parent'),u=b('Run'),v=b('SubscriptionsHandler'),w=b('Vector'),x=b('ViewportBounds'),y=b('emptyFunction'),z=b('ge'),aa=b('getActiveElement'),ba=b('isAsyncScrollQuery'),ca=b('throttle'),da;function ea(){da=k.hasClass(document.documentElement,'tinyViewport')?0:g('pagelet_bluebar').offsetTop+g('pagelet_bluebar').offsetHeight;}ea.defer();o.listen(window,'resize',ca(ea));function fa(ga){this.root=ga;this.init();}fa.prototype.getStories=function(){};fa.prototype.getParentStory=function(ga){};fa.prototype.isStory=function(ga){};fa.prototype.isHoldoutStory=function(ga){};fa.prototype.getHeadline=function(ga){};fa.prototype.getPreviousStory=function(ga){};fa.prototype.getNextStory=function(ga){};fa.prototype.setSelected=function(ga,ha){};fa.prototype.clickLike=function(){};fa.prototype.clickComment=function(){};fa.prototype.clickShare=function(){};fa.prototype.openAttachment=function(){};fa.prototype.focusComposer=function(){var ga=l.scry(z('pagelet_composer'),'textarea')[0];if(ga){p.set(ga);m.scrollToTop(true);}};fa.prototype.getScrollOffset=function(){return 10;};fa.prototype.getAnimationLength=function(ga){return Math.min(Math.abs(w.getElementPosition(ga).y-x.getTop()-document.body.scrollTop),400);};fa.prototype.findTop=function(){var ga=this.getStories();for(var ha=0;ha<ga.length;ha++)if(w.getElementPosition(ga[ha]).y>w.getScrollPosition().y)return ga[ha];};fa.prototype.onLeave=function(){this.subscriptions&&this.subscriptions.release();};fa.prototype.getHelpDialogRequest=function(){if(!this.dialogRequest){this.dialogRequest=new j('/ajax/keyboard_shortcuts');this.dialogRequest.setReadOnly(true);}else if(this.dialogRequest.transport)return null;return this.dialogRequest;};fa.prototype.init=function(){u.onLeave(this.onLeave.bind(this));this.subscriptions=new v();this.subscriptions.addSubscriptions(h.subscribe(s.NAVIGATION_BEGIN,this.onLeave.bind(this)),q.register('j',this.vert.bind(this,1)),q.register('k',this.vert.bind(this,-1)),q.register('l',this.clickLike.bind(this),{filter:this.hasActiveStory.bind(this)}),q.register('c',this.clickComment.bind(this),{filter:this.hasActiveStory.bind(this)}),q.register('o',this.openAttachment.bind(this),{filter:this.hasActiveStory.bind(this)}),q.register('p',this.focusComposer.bind(this),{filter:this.hasActiveStory.bind(this)}),q.register('s',this.clickShare.bind(this),{filter:this.hasActiveStory.bind(this)}),q.register('SLASH',function(){var ga=this.getHelpDialogRequest();ga&&i.send(ga);}.bind(this),{filter:function(event,ga){return event.getModifiers().shift;}}),q.register('RETURN',function(){if(this.selected.id==='pagelet_composer'||z('pagelet_composer',this.selected)){var ga=l.scry(this.selected,'textarea')[0];ga&&p.set(ga);}else this.clickComment();}.bind(this),{filter:this.hasActiveStory.bind(this)}),q.register('ESCAPE',function(){var ga=this.findTop();ga&&this.setFocused(ga);}.bind(this),{baseFilters:[r.filterEventTypes,r.filterEventModifiers]}),o.listen(document,'focusin',function(event){var ga=event.getTarget(),ha=this.getParentStory(ga);if(ha&&(this.selected!=ha)){this.setSelected(ha,false);if(!this.isInteractive(ga))this.setFocused(ha);}}.bind(this)));};fa.prototype.hasActiveStory=function(event,ga){var ha=aa();return !(ha&&k.shown(ha))||!!this.getParentStory(ha);};fa.prototype.click=function(ga){if(!this.selected)return;var ha;for(var ia=0,ja=arguments.length;ia<ja;ia++){ha=l.scry(this.selected,arguments[ia])[0];if(ha&&k.shown(ha)){ha.click();return;}}};fa.prototype.vert=function(ga){if(!this.scrollInitialized){this.subscriptions.addSubscriptions(o.listen(document,'scroll',function(){if(this.selected&&!this.scrolling)this.setSelected(null,true);}.bind(this)));this.scrollInitialized=true;}var ha;if(this.selected){if(this.selected.id=='pagelet_composer'){ha=ga>0?this.getStories()[0]:null;if(this.isHoldoutStory(ha))ha=this.getPreviousStory(ha);}else ha=ga>0?this.getNextStory(this.selected):(this.getPreviousStory(this.selected)||z('pagelet_composer'));if(!ha){return;}else if(!n.isElementNode(ha)){k.removeClass(this.selected,'selectedStorySimple');this.selected=ha;return this.vert(ga);}}if(!ha||t.byClass(ha,'hidden_elem')||!l.contains(document,ha)){ha=this.findTop();if(ha&&ga<0)ha=this.getPreviousStory(ha);if(this.isHoldoutStory(ha))ha=this.getPreviousStory(ha);}if(!ha)return;this.anim&&this.anim.stop();var ia=(Date.now()-(this.lastScroll||0)>30),ja=this.setFocused.bind(this,ha);if(ba()){ia=false;ja();ja=y;}this.scrolling=true;this.scrollingTimer&&window.clearTimeout(this.scrollingTimer);this.anim=m.scrollTo(ha,ia?this.getAnimationLength(ha):0,false,w.getViewportDimensions().y-da-this.getScrollOffset(),function(){this.scrollingTimer=window.setTimeout(function(){this.scrolling=false;}.bind(this),300);ja();}.bind(this));this.setSelected(ha,true);this.lastScroll=Date.now();};fa.prototype.isInteractive=function(ga){return ((ga.nodeName=='INPUT')||(ga.nodeName=='BUTTON')||(ga.nodeName=='TEXTAREA')||(ga.nodeName=='A')||!!t.byAttribute(ga,'contenteditable'));};fa.prototype.setTabindexOnHeadline=function(ga,ha){if(this.isStory(ga)){var ia=this.getHeadline(ga);if(ia)ia.tabIndex=ha;}};fa.prototype.setFocused=function(ga){if(this.isStory(ga)){var ha=this.getHeadline(ga);ha&&p.setWithoutOutline(ha);}};e.exports=fa;});
__d("FeedKeyboardController",["CSS","DOM","DOMQuery","FeedBaseKeyboardController","Parent","csx"],function(a,b,c,d,e,f){var g=b('CSS'),h=b('DOM'),i=b('DOMQuery'),j=b('FeedBaseKeyboardController'),k=b('Parent'),l=b('csx');for(var m in j)if(j.hasOwnProperty(m))o[m]=j[m];var n=j===null?null:j.prototype;o.prototype=Object.create(n);o.prototype.constructor=o;o.__superConstructor__=j;function o(){if(j!==null)j.apply(this,arguments);}o.prototype.getStories=function(){return h.scry(this.root,'li.uiStreamStory');};o.prototype.getParentStory=function(p){if(!h.contains(this.root,p))return;return k.byClass(p,'uiStreamStory');};o.prototype.isStory=function(p){return g.hasClass(p,'uiStreamStory');};o.prototype.getHeadline=function(p){return i.scry(p,'h5.uiStreamHeadline')[0];};o.prototype.clickLike=function(){this.click('.UFILikeLink');};o.prototype.clickComment=function(){this.click('.comment_link');};o.prototype.clickShare=function(){this.click('.share_action_link');};o.prototype.openAttachment=function(){this.click(".uiStreamAttachments ._5dec",'.uiStreamAttachments a.uiVideoThumb','.uiStreamAttachments a.shareText','.uiStreamAttachments a[rel="theater"]','.uiStreamAttachments .shareMediaLink');};o.prototype.isHoldoutStory=function(p){return !!p&&g.hasClass(p,'holdoutAdStory');};o.prototype.isRelevantStory=function(p){return i.isElementNode(p)&&!this.isHoldoutStory(p);};o.prototype.getPreviousStory=function(p){var q=p.previousSibling;while(q&&!this.isRelevantStory(q))q=q.previousSibling;return q;};o.prototype.getNextStory=function(p){var q=p.nextSibling;while(q&&!this.isRelevantStory(q))q=q.nextSibling;return q;};o.prototype.setSelected=function(p,q){if(p){var r=i.scry(p,'.selectedStoryIndicator');if(!r.length)h.prependContent(p,h.create('div',{'class':'selectedStoryIndicator'}));}this.selected&&this.setTabindexOnHeadline(this.selected,'-1');this.selected&&g.removeClass(this.selected,'selectedStorySimple');this.selected=p;p&&this.setTabindexOnHeadline(p,'0');p&&g.addClass(p,'selectedStorySimple');};e.exports=o;});
__d("FeedTrackingAsync",["Event","collectDataAttributes","copyProperties"],function(a,b,c,d,e,f){var g=b('Event'),h=b('collectDataAttributes'),i=b('copyProperties');function j(){g.listen(document.documentElement,'AsyncRequest/send',function(event){var k=event.getTarget(),l=event.getData().request,m=l.getData(),n=h(k,['ft']);i(m,n);});}e.exports={init:j};});
__d("MercuryLeftNavCountControl",["Arbiter","CSS","DOM","MercuryThreadlistConstants","MessagingTag","MercuryThreadInformer","MercuryUnreadState","copyProperties"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('CSS'),i=b('DOM'),j=b('MercuryThreadlistConstants'),k=b('MessagingTag'),l=b('MercuryThreadInformer').get(),m=b('MercuryUnreadState').get(),n=b('copyProperties'),o,p,q=function(r,s){o=r;p=s;this.render();this.listenerToken=l.subscribe('unread-updated',this.render.bind(this));this.subscriptions=[g.subscribe('onload/exit',this.cleanup.bind(this))];};n(q.prototype,{render:function(){var r=m.exceedsMaxCount(k.INBOX);if(r){i.setContent(o,j.MAX_UNREAD_COUNT);}else{var s=m.getUnreadCount(k.INBOX);i.setContent(o,s.toString());h.conditionClass(o.parentNode,'hidden_elem',s<=0);}i.setContent(p,r?'+':'');},cleanup:function(){this.subscriptions.forEach(g.unsubscribe);l.unsubscribe(this.listenerToken);}});e.exports=q;});
__d("MercuryLeftNav",["DOM","MercuryServerRequests","MercuryLeftNavCountControl"],function(a,b,c,d,e,f){var g=b('DOM'),h=b('MercuryServerRequests').get(),i=b('MercuryLeftNavCountControl');function j(k,l){h.handleUpdate(l);var m=g.scry(k,'span.countValue')[0],n=g.scry(k,'span.maxCountIndicator')[0];new i(m,n);}e.exports=j;});
__d("startMessagingNavCountUpdater",["CounterDisplay","DOM","FutureSideNav"],function(a,b,c,d,e,f){var g=b('CounterDisplay'),h=b('DOM'),i=b('FutureSideNav');function j(n){var o=i.getInstance().getNodeForKey('inbox');if(!o)return;var p=i.getInstance().getNodeForKey('other'),q=h.scry(p,'span.count')[0],r=h.scry(q,'span.countValue')[0],s=h.scry(q,'span.maxCountIndicator')[0];new m('other_unseen',r,q,null,null,true).setMaxCounter(n,s);}for(var k in g)if(g.hasOwnProperty(k))m[k]=g[k];var l=g===null?null:g.prototype;m.prototype=Object.create(l);m.prototype.constructor=m;m.__superConstructor__=g;function m(){this._maxValue=null;this._maxIndicatorNode=null;g.apply(this,arguments);}m.prototype.setMaxCounter=function(n,o){this._maxValue=n;this._maxIndicatorNode=o;};m.prototype.paint=function(){var n=this._maxValue&&this._count>this._maxValue,o=n?this._maxValue:this._count;if(this._maxIndicatorNode){h.setContent(this._maxIndicatorNode,n?'+':'');}else if(n)o=o+'+';h.setContent(this._valueNode,o);this._toggleNodes();};e.exports=j;});
__d("legacy:messaging-nav-count",["startMessagingNavCountUpdater"],function(a,b,c,d){a.startMessagingNavCountUpdater=b('startMessagingNavCountUpdater');},3);
__d("ViewportTracking",["Arbiter","Banzai","DOM","DOMDimensions","DOMPosition","Event","NavigationMessage","Run","Style","SubscriptionsHandler","UIIntentionalStreamMessage","UserActivity","Vector","clickRefAction","collectDataAttributes","copyProperties","debounce","throttle"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('Banzai'),i=b('DOM'),j=b('DOMDimensions'),k=b('DOMPosition'),l=b('Event'),m=b('NavigationMessage'),n=b('Run'),o=b('Style'),p=b('SubscriptionsHandler'),q=b('UIIntentionalStreamMessage'),r=b('UserActivity'),s=b('Vector'),t=b('clickRefAction'),u=b('collectDataAttributes'),v=b('copyProperties'),w=b('debounce'),x=b('throttle'),y=97,z='vpv';function aa(){}aa.prototype.init=function(ba){this.useBanzai=!!ba.banzai;this.readStoryIDs={};this.minSizeToBeVisible=200;this.minFractionToBeVisibleForTimetracking=.5;this.minFractionForAdditionalView=0;this.timetrackingThrottlingInterval=100;this.minTimeToReportImmediately=500;this.cachedAllStories=null;this.cachedViewportHeight=j.getViewportDimensions().height;this.isTimetrackingEnabled=0;this.storyEnteredVPTimestamp={};this.alreadyLoggedDurationStories=[];this.userInactiveLock=false;this.userActivityPollerTimeoutID=-1;this._headLoadStoryCount=0;this.getDataFromConfig(ba);this.isLoose=!!ba.is_loose;this.maxScrollPosition=0;this.porportionRatio=.5;this.is_proportion=!!ba.is_proportion;if(this.is_proportion)this.proportionRatio=ba.proportion_ratio;if(ba.tracking_duration_config){this.timetrackingThrottlingInterval=ba.tracking_duration_config.timetracking_throttling_interval;this.userActivityPollingInterval=ba.tracking_duration_config.user_activity_polling_interval;this.timeToBeConsideredInactive=ba.tracking_duration_config.time_to_be_considered_inactive;this.minFractionToBeVisibleForTimetracking=ba.tracking_duration_config.min_fraction_to_be_visible;this.minTimeToReportImmediately=ba.tracking_duration_config.min_time_to_report_immediately;this.minFractionForAdditionalView=ba.tracking_duration_config.min_fraction_for_additional_view;}var ca,da=w(this.fireTimer,this.getTimeout(),this);if(this.isLoose){this.minSizeToBeVisible=0;ca=x(function(){this.maxScrollPosition=Math.max(this.maxScrollPosition,s.getScrollPosition().y);da();}.bind(this));}else ca=da;this.fireTimer();var ea=x(this.updateTimeTrackingData.bind(this,false),this.timetrackingThrottlingInterval);this.subscriptions=new p();this.subscriptions.addSubscriptions(this._getScrollListener(ca),l.listen(window,'resize',function(){this.cachedViewportHeight=j.getViewportDimensions().height;ca();}.bind(this)),g.subscribe(q.UPDATE_HTML_CONTENT,function(){if(r.isActive())ca();}.bind(this)),g.subscribe(m.NAVIGATION_BEGIN,this.cleanup.bind(this)),g.subscribe('Stream/totalHeadLoadedStories',function(fa,ga){this._headLoadStoryCount=ga;}.bind(this)));if(this.isTimetrackingEnabled){this.updateTimeTrackingData(false);this.subscriptions.addSubscriptions(this._getScrollListener(ea));this._userActivityPoller();}n.onLeave(this.cleanup.bind(this));};aa.prototype._getScrollListener=function(ba){return l.listen(window,'scroll',ba);};aa.prototype.cleanup=function(){if(this.subscriptions){this.subscriptions.release();this.subscriptions=null;}if(this.isTimetrackingEnabled){clearTimeout(this.userActivityPollerTimeoutID);this.updateTimeTrackingData(true);}this._headLoadStoryCount=0;};aa.prototype.fireTimer=function(){this.getStoriesInView().forEach(this.markStoryRead.bind(this));};aa.prototype._userActivityPoller=function(){if(!this.userInactiveLock&&!r.isActive(this.timeToBeConsideredInactive)){this.userInactiveLock=true;this.updateTimeTrackingData(true);r.subscribeOnce(function(){this.updateTimeTrackingData(false);this.userInactiveLock=false;}.bind(this));}this.userActivityPollerTimeoutID=setTimeout(this._userActivityPoller.bind(this),this.userActivityPollingInterval);};aa.prototype.addVisibleStoriesTimestamps=function(ba,ca){var da={};for(var ea=0,fa=ba.length;ea<fa;ea++){var ga=this.getStoryID(ba[ea]);da[ga]=true;if(ga in this.storyEnteredVPTimestamp)continue;this.storyEnteredVPTimestamp[ga]={ts:ca,story:ba[ea]};}return da;};aa.prototype.removeTimestampsOfStoriesNotInView=function(ba,ca){for(var da in this.storyEnteredVPTimestamp)if(!(da in ba)){this.recordTimeStoryWasInView(this.storyEnteredVPTimestamp[da].story,this.storyEnteredVPTimestamp[da].ts,ca);delete this.storyEnteredVPTimestamp[da];}};aa.prototype.updateTimeTrackingData=function(ba){if(!this.storyEnteredVPTimestamp)this.storyEnteredVPTimestamp={};var ca=Date.now(),da={},ea;if(!ba)da=this.getAllStoriesInView();ea=this.addVisibleStoriesTimestamps(da,ca);this.removeTimestampsOfStoriesNotInView(ea,ca);};aa.prototype.getStoriesInView=function(){var ba=this.getAllStories(),ca=[],da=false;for(var ea=0;ea<ba.length;ea++){var fa=ba[ea],ga=this.getStoryID(fa);if(this.hasBeenVisible(ga))continue;if(this.isVisible(fa)){if(fa.getAttribute('data-insertion-position')===null)fa.setAttribute('data-insertion-position',ea-this._headLoadStoryCount);ca.push(fa);da=true;}else if(da)break;}return ca;};aa.prototype.getAllStoriesFromCache=function(){if(this.cachedAllStories===null)this.cachedAllStories=this.getAllStories();return this.cachedAllStories;};aa.prototype.invalidateAllStoriesCache=function(){this.cachedAllStories=null;};aa.prototype.getAllStoriesInView=function(){var ba=this.getAllStoriesFromCache(),ca=[],da=false,ea=0,fa=ba.length,ga=1;if(this._indexOfLastVisibleStoryOnPreviousPass>fa/2){ea=fa-1;fa=-1;ga=-ga;}for(var ha=ea;ha!=fa;ha+=ga){var ia=ba[ha];if(this._isVisible(ia,false,this.minFractionToBeVisibleForTimetracking*j.getElementDimensions(ia).height)){if(ia.getAttribute('data-insertion-position')===null)ia.setAttribute('data-insertion-position',ha-this._headLoadStoryCount);ca.push(ia);da=true;}else if(da){this._indexOfLastVisibleStoryOnPreviousPass=ha-ga;break;}}for(ha=this.alreadyLoggedDurationStories.length-1;ha>=0;ha--){ia=this.alreadyLoggedDurationStories[ha];if(!this._isVisible(ia,false,this.minFractionForAdditionalView*j.getElementDimensions(ia).height))this.alreadyLoggedDurationStories.splice(ha,1);}return ca;};aa.prototype.getTimetrackingDataToLog=function(ba,ca,da){var ea={evt:y,vpvd_start_timestamp:ca,vpvd_time_delta:da-ca,story_height:j.getElementDimensions(ba).height,viewport_height:this.cachedViewportHeight};return {ft:ea};};aa.prototype.recordTimeStoryWasInView=function(ba,ca,da){if(this.isTimetrackingEnabled){if(this.alreadyLoggedDurationStories.indexOf(ba)>-1){return;}else this.alreadyLoggedDurationStories.push(ba);var ea=this.getTimetrackingDataToLog(ba,ca,da),fa=u(ba,['ft']);v(ea.ft,fa.ft);var ga=!!fa.ft.ei&&(ea.ft.vpvd_time_delta>this.minTimeToReportImmediately);delete ea.ei;this.sendDataToLog(ba,ea,ga);}};aa.prototype.hasBeenVisible=function(ba){return ba in this.readStoryIDs;};aa.prototype.isVisible=function(ba){return this._isVisible(ba,this.isLoose,this.minSizeToBeVisible);};aa.prototype._isVisible=function(ba,ca,da){var ea=s.getScrollPosition().y,fa=j.getViewportDimensions().height,ga=k.getElementPosition(ba),ha=j.getElementDimensions(ba),ia=fa+this.maxScrollPosition-ea;if(!ga.x&&!ga.y&&!ha.x&&!ha.y)return false;if(ca&&ga.y<ia)return true;var ja=Math.max(ga.y,0),ka=Math.min(ga.y+ha.height,fa),la;if(this.is_proportion){la=ha.height*this.proportionRatio;}else la=Math.min(ha.height,da);return (ka-ja)>=la;};aa.prototype.sendDataToLog=function(ba,ca,da){if(this.useBanzai){var ea={};if(da)ea.delay=0;h.post('feed_tracking',ca,ea);}else t(z,ba,null,'FORCE',ca);};aa.prototype.markStoryRead=function(ba){var ca=this.getStoryID(ba);if(!ca||this.hasBeenVisible(ca))return;this.readStoryIDs[ca]=true;var da=this.getDataToLog(ba),ea=i.scry(ba,".fbStoryAttachmentImage")[0];if(ea){var fa=j.getElementDimensions(ea).width,ga=j.getElementDimensions(ea).height;da.ft.story_image_height=ga;da.ft.story_image_width=fa;}var ha=u(ba,['ft']);v(da.ft,ha.ft);delete da.ei;this.sendDataToLog(ba,da,false);};e.exports=aa;});
__d("collectSubtreeData",[],function(a,b,c,d,e,f){function g(i,j,k,l,m){if(i.offsetWidth===0&&i.offsetHeight===0)return m;var n={};if(i.getAttribute)for(r=0;r<j.length;r++){t=j[r];var o=i.getAttribute(k[t]);if(o){n[t]={};var p=JSON.parse(o);for(var q in l)if(p[q]!==undefined){n[t][q]=true;if(m[t]===undefined)m[t]={};if(m[t][q]===undefined)m[t][q]=[];if(l[q].length>0)m[t][q].push(l[q]);m[t][q].push('('+p[q]);}}}for(var r=0;r<i.childNodes.length;r++){var s=i.childNodes[r];g(s,j,k,l,m);}for(var t in n)for(var u in n[t]){var v=m[t][u][m[t][u].length-1];if(v.length>0&&v.charAt(0)=='('){m[t][u][m[t][u].length-1]=v.substr(1);}else m[t][u].push(')');}return m;}function h(i,j){var k={};for(var l=0;l<j.length;++l)k[j[l]]='data-'+j[l];var m={tn:"","tn-debug":","},n={};g(i,j,k,m,n);for(var o in n)for(var p in n[o])n[o][p]=n[o][p].join('');return n;}e.exports=h;});
__d("recordTNTreeData",["collectSubtreeData"],function(a,b,c,d,e,f){var g=b('collectSubtreeData');function h(i,j){var k={},l=g(i,['ft']);for(var m in l.ft){k[m+'_tree']=l.ft[m];if(m==='tn-debug')i.setAttribute('tn-debug_subtree',l.ft[m]);}k.evt_value=i.offsetHeight;if(j)k.offset=Math.max(0,i.offsetTop-j.offsetTop);return k;}e.exports=h;});
__d("StoryTopicMap",[],function(a,b,c,d,e,f){var g={},h={registerTopics:function(i,j){g[i]=j;},getTopicsForFTID:function(i){return g[i]||[];}};e.exports=h;});
__d("XPubcontentFeedChainingControllerURIBuilder",["XControllerURIBuilder"],function(a,b,c,d,e,f){var g=b('XControllerURIBuilder');e.exports=g.create("\/pubcontent\/feed_chaining\/",{origin:{type:"String",required:true},ft_id:{type:"String"},actor_id:{type:"Int",required:true}});});
__d("XPubcontentRelatedShareChainingControllerURIBuilder",["XControllerURIBuilder"],function(a,b,c,d,e,f){var g=b('XControllerURIBuilder');e.exports=g.create("\/pubcontent\/related_share\/",{attachment_div_id:{type:"String",required:true},video_div_id:{type:"String"},global_share_id:{type:"Int",required:true}});});
__d("XPubcontentTopicChainingControllerURIBuilder",["XControllerURIBuilder"],function(a,b,c,d,e,f){var g=b('XControllerURIBuilder');e.exports=g.create("\/pubcontent\/topic_chaining\/",{pivotal_topic_ids:{type:"IntVector"}});});
__d("PubcontentFeedChainingController",["Arbiter","AsyncRequest","AttachmentRelatedShareConstants","DOM","PageLikeButton","PubcontentFeedChainingConfig","PubcontentRelatedShareChainingConfig","PubcontentTopicChainingConfig","StoryTopicMap","UFIFeedbackTargets","UFIUIEvents","XPubcontentFeedChainingControllerURIBuilder","XPubcontentRelatedShareChainingControllerURIBuilder","XPubcontentTopicChainingControllerURIBuilder"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('AsyncRequest'),i=b('AttachmentRelatedShareConstants'),j=b('DOM'),k=b('PageLikeButton'),l=b('PubcontentFeedChainingConfig'),m=b('PubcontentRelatedShareChainingConfig'),n=b('PubcontentTopicChainingConfig'),o=b('StoryTopicMap'),p=b('UFIFeedbackTargets'),q=b('UFIUIEvents'),r=b('XPubcontentFeedChainingControllerURIBuilder'),s=b('XPubcontentRelatedShareChainingControllerURIBuilder'),t=b('XPubcontentTopicChainingControllerURIBuilder'),u='pubcontentFeedChainingWrapper',v='page_story_like_action',w='related_share_article_click',x='related_share_video_click',y='page_share_like_action',z='topic_story_like_action';function aa(){this.$PubcontentFeedChainingController0=l;this.$PubcontentFeedChainingController1=m;this.$PubcontentFeedChainingController2=n;this.$PubcontentFeedChainingController3={};g.subscribe(k.LIKED,this.$PubcontentFeedChainingController4.bind(this));g.subscribe(q.UFIActionLinkLike,this.$PubcontentFeedChainingController5.bind(this));g.subscribe(i.ARTICLE_CLICK,this.$PubcontentFeedChainingController6.bind(this));aa.instance=this;}aa.prototype.$PubcontentFeedChainingController4=function(ba,ca){this.$PubcontentFeedChainingController7(ca.target,{origin:ca.origin,actor_id:ca.profile_id});};aa.prototype.$PubcontentFeedChainingController5=function(ba,ca){if(!ca.ft_id)return;p.getFeedbackTarget(ca.ft_id,function(da,ea){if(ea.isownerpage){this.$PubcontentFeedChainingController7(da,{actor_id:ea.actorid,origin:v});}else if(ea.isshare){this.$PubcontentFeedChainingController7(da,{actor_id:ea.actorid,ft_id:ea.entidentifier,origin:y});}else{var fa=o.getTopicsForFTID(ea.entidentifier);if(fa&&fa.length>0)this.$PubcontentFeedChainingController8(da,{ft_id:ea.entidentifier,origin:z,pivotal_topic_ids:fa});}}.bind(this,ca.target));};aa.prototype.$PubcontentFeedChainingController6=function(ba,ca){ca.origin=w;this.$PubcontentFeedChainingController9(ca.attachment,ca);};aa.prototype.$PubcontentFeedChainingControllera=function(ba,ca){ca.origin=x;this.$PubcontentFeedChainingController9(ca.attachment,ca);};aa.prototype.$PubcontentFeedChainingControllerb=function(ba){return !!(ba&&ba.id&&!(ba.id in this.$PubcontentFeedChainingController3));};aa.prototype.$PubcontentFeedChainingControllerc=function(ba){if(!ba)return false;if(ba.origin in this.$PubcontentFeedChainingController0||ba.origin in this.$PubcontentFeedChainingController1){return true;}else{var ca=this.$PubcontentFeedChainingController2[ba.origin];if(!ca||!ca.rate)return false;var da=Math.random();if(da>ca.rate)return false;return true;}};aa.prototype.$PubcontentFeedChainingControllerd=function(ba){this.$PubcontentFeedChainingController3[ba]=true;};aa.prototype.$PubcontentFeedChainingControllere=function(ba){delete this.$PubcontentFeedChainingController3[ba];};aa.prototype.$PubcontentFeedChainingControllerf=function(ba,ca){var da=this.findStory(ba);if(!this.$PubcontentFeedChainingControllerb(da))return null;if(!this.$PubcontentFeedChainingControllerc(ca))return null;var ea=this.findContainer(da);if(!ea)return null;this.$PubcontentFeedChainingControllerd(da.id);var fa=j.create('div',{id:u}),ga=j.appendContent(ea,fa);if(ga.length!==1)return null;return {chainingWrapper:ga[0],story:da};};aa.prototype.$PubcontentFeedChainingController9=function(ba,ca){var da=this.$PubcontentFeedChainingControllerf(ba,ca);if(!da)return false;var ea=(new s()).setInt('global_share_id',ca.global_share_id).setString('attachment_div_id',j.getID(ca.attachment));if(ca.video_div_id)ea.setString('video_div_id',ca.video_div_id);var fa=new h().setErrorHandler(this.$PubcontentFeedChainingControllere.bind(this,da.story.id)).setRelativeTo(da.chainingWrapper).setURI(ea.getURI()),ga=JSON.parse(da.story.getAttribute('data-ft'))||{};ga&&fa.setData(ga);fa.send();return true;};aa.prototype.$PubcontentFeedChainingController7=function(ba,ca){var da=this.$PubcontentFeedChainingControllerf(ba,ca);if(!da)return false;var ea=(new r()).setInt('actor_id',ca.actor_id).setString('origin',ca.origin);if(ca.ft_id)ea.setString('ft_id',ca.ft_id);new h().setErrorHandler(this.$PubcontentFeedChainingControllere.bind(this,da.story.id)).setRelativeTo(da.chainingWrapper).setURI(ea.getURI()).send();return true;};aa.prototype.$PubcontentFeedChainingController8=function(ba,ca){var da=this.$PubcontentFeedChainingControllerf(ba,ca);if(!da)return false;var ea=(new t()).setIntVector('pivotal_topic_ids',ca.pivotal_topic_ids).getURI();new h().setErrorHandler(this.$PubcontentFeedChainingControllere.bind(this,da.story.id)).setRelativeTo(da.chainingWrapper).setURI(ea).send();return true;};e.exports=aa;});
__d("PubcontentLegacyFeedChainingController",["DOM","PubcontentFeedChainingController"],function(a,b,c,d,e,f){var g=b('DOM'),h=b('PubcontentFeedChainingController');for(var i in h)if(h.hasOwnProperty(i))k[i]=h[i];var j=h===null?null:h.prototype;k.prototype=Object.create(j);k.prototype.constructor=k;k.__superConstructor__=h;function k(){if(h!==null)h.apply(this,arguments);}k.prototype.findStory=function(l){var m=g.scry(l,'^li.uiStreamStory');return m.length===1?m[0]:null;};k.prototype.findContainer=function(l){var m=g.scry(l,"div[role='article']");return m.length>=1?m[0]:null;};e.exports=k;new k();});
__d("StreamViewportTracking",["Arbiter","DOM","UIIntentionalStreamMessage","ViewportTracking","ge","recordTNTreeData"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('DOM'),i=b('UIIntentionalStreamMessage'),j=b('ViewportTracking'),k=b('ge'),l=b('recordTNTreeData'),m=51;for(var n in j)if(j.hasOwnProperty(n))p[n]=j[n];var o=j===null?null:j.prototype;p.prototype=Object.create(o);p.prototype.constructor=p;p.__superConstructor__=j;function p(){if(j!==null)j.apply(this,arguments);}p.prototype.init=function(q,r){if(r)this.$StreamViewportTracking0=r;o.init.call(this,q);this.initSubscriptions();};p.prototype.initSubscriptions=function(){this.subscriptions.addSubscriptions(g.subscribe(i.UPDATE_LAST_REFRESH_TIME,this.invalidateAllStoriesCache.bind(this)),g.subscribe(i.UNLOAD,this.updateTimeTrackingData.bind(this,true)));};p.prototype.getDataFromConfig=function(q){this.recordTNTree=q.record_tn_tree;this.timeout=q.record_delay;this.isTimetrackingEnabled=!!q.is_timetracking_enabled;};p.prototype.getTimeout=function(){return this.timeout;};p.prototype.getStorySelector=function(){return '.uiStreamStory';};p.prototype.getAllStories=function(){var q=h.scry(this.getStream(),this.getStorySelector());return q.filter(function(r){return r.getAttribute('data-ft');});};p.prototype.getStoryID=function(q){var r=JSON.parse(q.getAttribute('data-ft'));return r.mf_story_key;};p.prototype.getDataToLog=function(q){var r={};if(this.recordTNTree){var s=this.getStream();r=l(q,s);var t=q.getAttribute('data-insertion-position');if(t!==null)r.inspos=t;}r.evt=m;return {ft:r};};p.prototype.getStream=function(){if(this.$StreamViewportTracking0)return this.$StreamViewportTracking0;return k('home_stream');};p.init=function(q,r){p.instance=new p();p.instance.init(q,r);};p.getInstance=function(){return p.instance;};e.exports=p;});
__d("legacy:UIIntentionalStream",["UIIntentionalStream"],function(a,b,c,d){a.UIIntentionalStream=b('UIIntentionalStream');},3);
__d("legacy:UIIntentionalStream-message",["UIIntentionalStreamMessage"],function(a,b,c,d){a.UIIntentionalStreamMessage=b('UIIntentionalStreamMessage');},3);
__d("legacy:UIIntentionalStreamRefresh",["UIIntentionalStreamRefresh"],function(a,b,c,d){a.UIIntentionalStreamRefresh=b('UIIntentionalStreamRefresh');},3);